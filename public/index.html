<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="theme-color" content="#000000">
    <title>Movies</title>

    <!-- Bootstrap -->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">

    <style> 
    html, body {
      font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif; 
      background-color: #fff;
      flex: 1;
    }
    .card {
      padding: 20px;
      align-items: center;
    }
    </style>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body onload="searchMovies()">
    <div class="container">
      <h1>Movies App</h1>
      <div class="col s12 m12 l9">
         Discover your favorite movies.
      </div>
      <!--
        This HTML file is a template.
        If you open it directly in the browser, you will see an empty page.
        You can add webfonts, meta tags, or analytics to this file.
        The build step will place the bundled scripts into the <body> tag.
        To begin the development, run `npm start` or `yarn start`.
        To create a production bundle, use `npm run build` or `yarn build`.
      -->
      <nav class="navbar navbar-inverse">
      <form class="form-inline" id="search-form" onsubmit="return searchMovies()">
        <input class="form-control mr-sm-2" id="search-field" type="text" placeholder="Search Movies...">
        <input type="submit" class="btn btn-info">
      </form>
      <br />
      <div id="movies">
      </div>
    </div>
  </body>
  <footer>
  <script>
  // Queries OMDB Movies API and parses out response results.
  function searchMovies() {
    var text = document.getElementById("search-field").value;
    if (!text || !text.length) {
      // Placeholder text in case no search query is submitted.
      text = "avengers"
    }
    const url = 'http://www.omdbapi.com/?apikey=b51fd28e&s=' + text;
    fetch(url)
    .then(function(response) {
      return response.json();
    })
    .then(function(json) {
      // Parse out the movies Search response.
      const movies = json["Search"];
      if (movies && movies.length) {
          insertMovies(movies);
      } else {
        console.log("Error: No Movies found.")
      }
    })
    .catch(function(err) {
      console.log(err);
    });
    // return false to stop page refresh
    return false;
  };

  // Creates cards to display movie information.
  function insertMovies(movies) {
    const arr = movies.map(function(movie, index) {
      const title = movie["Title"];
      const year = movie["Year"];
      const imdbID = movie["imdbID"];
      const poster = movie["Poster"];
      console.log(movie);
      const node = '<div class="card" id="movie-' + imdbID + '"><div className="card-content">' + '<a target="_blank" href="https://www.imdb.com/title/' + imdbID + '">' + '<h2>' + title + '</h2>' + '<h3> Released: ' + year + '</h3>' + '<img src=' + poster + 'alt="Movie Thumbnail" class="img-responsive" />' + '</a>' + '</div></div>' 
      return node;
    });

    const list = arr.join('');
    const node = document.getElementById( 'movies' );
    while (node.lastChild) {
      node.removeChild(node.lastChild);
    };
    node.insertAdjacentHTML( 'beforeend', list );
  }

  </script>
  </footer>
</html>
